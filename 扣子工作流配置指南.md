# 🎯 扣子工作流配置指南

## 📋 在扣子工作流中使用圆形图片转换服务

### 步骤1: 部署网站

1. **选择部署平台**（推荐Railway或Heroku）
2. **上传代码并部署**
3. **获取网站URL**（例如：`https://your-app.railway.app`）

### 步骤2: 配置扣子工作流

#### 方案A: 使用图片上传节点 + HTTP请求节点

1. **添加图片上传节点**
   - 节点类型：图片上传
   - 功能：上传要转换的图片

2. **添加HTTP请求节点**
   - **URL**: `https://your-app.railway.app/api/convert`
   - **方法**: `POST`
   - **请求头**:
     ```
     Content-Type: application/json
     ```
   - **请求体**:
     ```json
     {
       "image_base64": "{{图片上传节点的输出}}"
     }
     ```

3. **添加输出节点**
   - 接收HTTP请求节点的响应
   - 提取 `image_base64` 字段作为圆形图片结果

#### 方案B: 使用图片URL输入（推荐）

1. **添加HTTP请求节点**
   - **URL**: `https://your-app.railway.app/api/convert-url`
   - **方法**: `POST`
   - **请求头**:
     ```
     Content-Type: application/json
     ```
   - **请求体**:
     ```json
     {
       "image_url": "https://example.com/image.jpg",
       "size": 400,
       "return_type": "url"
     }
     ```

#### 方案C: 直接使用图片base64数据

1. **添加HTTP请求节点**
   - **URL**: `https://your-app.railway.app/api/convert`
   - **方法**: `POST`
   - **请求头**:
     ```
     Content-Type: application/json
     ```
   - **请求体**:
     ```json
     {
       "image_base64": "data:image/png;base64,{{图片base64数据}}"
     }
     ```

### 步骤3: 参数配置详解

#### HTTP请求节点配置

##### 方案A: 图片上传 + base64转换
| 参数 | 值 | 说明 |
|------|-----|------|
| URL | `https://your-domain.com/api/convert` | 您的网站API地址 |
| 方法 | POST | 请求方法 |
| Content-Type | application/json | 请求头 |
| 请求体 | JSON格式 | 包含图片base64数据 |

##### 方案B: 图片URL输入（推荐）
| 参数 | 值 | 说明 |
|------|-----|------|
| URL | `https://your-domain.com/api/convert-url` | 您的网站API地址 |
| 方法 | POST | 请求方法 |
| Content-Type | application/json | 请求头 |
| 请求体 | JSON格式 | 包含图片URL |

#### 请求体格式

##### 方案A: base64输入
```json
{
  "image_base64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
  "size": 400
}
```

##### 方案B: URL输入
```json
{
  "image_url": "https://example.com/image.jpg",
  "size": 400,
  "return_type": "url"
}
```

**参数说明：**
- `image_base64`: 必填（方案A），图片的base64编码数据
- `image_url`: 必填（方案B），图片的URL地址
- `size`: 可选，指定输出图片的尺寸（像素）
- `return_type`: 可选（方案B），返回类型：`"url"`（返回URL）或`"base64"`（返回base64）

#### 响应格式

##### 方案A: base64输入响应
```json
{
  "success": true,
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAA...",
  "message": "图片已成功转换为圆形轮廓",
  "timestamp": "2024-01-01T12:00:00"
}
```

##### 方案B: URL输入响应（返回URL）
```json
{
  "success": true,
  "image_url": "https://your-domain.com/download/circular_abc123.png",
  "filename": "circular_abc123.png",
  "message": "图片已成功转换为圆形轮廓",
  "timestamp": "2024-01-01T12:00:00"
}
```

##### 方案B: URL输入响应（返回base64）
```json
{
  "success": true,
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAA...",
  "filename": "circular_abc123.png",
  "message": "图片已成功转换为圆形轮廓",
  "timestamp": "2024-01-01T12:00:00"
}
```

##### Vercel环境响应（URL输入）
```json
{
  "success": true,
  "image_url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
  "image_base64": "iVBORw0KGgoAAAANSUhEUgAA...",
  "filename": "circular_abc123.png",
  "message": "图片已成功转换为圆形轮廓（Vercel环境返回base64格式）",
  "timestamp": "2024-01-01T12:00:00"
}
```

### 步骤4: 错误处理

#### 常见错误及解决方案

1. **网络连接失败**
   - 检查网站URL是否正确
   - 确认网站服务是否正常运行

2. **图片数据格式错误**
   - 确保图片数据是有效的base64编码
   - 检查图片格式是否支持

3. **服务器错误**
   - 查看网站日志
   - 检查服务器资源使用情况

#### 错误响应格式

```json
{
  "success": false,
  "error": "错误描述信息"
}
```

### 步骤5: 测试工作流

1. **上传测试图片**
2. **运行工作流**
3. **检查输出结果**
4. **验证圆形效果**

### 🎨 完整工作流示例

#### 方案A: 图片上传工作流
```
[开始] → [图片上传] → [HTTP请求] → [图片输出] → [结束]
   ↓         ↓          ↓          ↓
 启动    上传图片   发送转换请求   显示圆形图片
```

#### 方案B: URL输入工作流（推荐）
```
[开始] → [HTTP请求] → [图片输出] → [结束]
   ↓         ↓          ↓
 启动   发送URL转换请求   显示圆形图片URL
```

#### 方案C: 混合工作流
```
[开始] → [图片URL] → [HTTP请求] → [图片URL输出] → [结束]
   ↓         ↓          ↓            ↓
 启动    输入图片URL   发送转换请求   获取圆形图片URL
```

### 🔧 高级配置

#### 自定义输出尺寸

在HTTP请求的请求体中添加 `size` 参数：

##### 方案A: base64输入
```json
{
  "image_base64": "{{图片数据}}",
  "size": 300
}
```

##### 方案B: URL输入
```json
{
  "image_url": "https://example.com/image.jpg",
  "size": 300,
  "return_type": "url"
}
```

#### 批量处理

如果需要处理多张图片，可以：

1. 使用循环节点
2. 为每张图片调用转换API
3. 收集所有结果

### 📊 性能优化建议

1. **图片大小控制**
   - 建议上传图片不超过5MB
   - 大图片可以预先压缩

2. **并发处理**
   - 网站支持多用户同时使用
   - 避免同时处理过多大图片

3. **缓存机制**
   - 相同图片可以缓存结果
   - 减少重复处理

### 🚨 注意事项

1. **网络稳定性**
   - 确保网站服务稳定运行
   - 建议使用可靠的云平台部署

2. **安全性**
   - 不要在请求中暴露敏感信息
   - 定期更新依赖包

3. **成本控制**
   - 监控API调用次数
   - 合理设置请求频率

### 📞 技术支持

如果在配置过程中遇到问题：

1. 检查网站是否正常运行
2. 验证API接口是否可访问
3. 查看扣子工作流的错误日志
4. 联系技术支持

### 🆕 新功能特性

#### URL输入支持
- ✅ 支持直接输入图片URL进行转换
- ✅ 自动下载并处理网络图片
- ✅ 支持多种图片格式（PNG、JPG、JPEG、GIF、BMP、WEBP）

#### 灵活的输出格式
- ✅ 支持返回处理后的图片URL
- ✅ 支持返回base64编码数据
- ✅ 自动适配不同部署环境（Vercel/其他平台）

#### 增强的错误处理
- ✅ 网络连接超时保护
- ✅ 图片格式验证
- ✅ 详细的错误信息反馈

### 📋 快速开始

**最简单的使用方式（推荐）：**

1. 在扣子工作流中添加HTTP请求节点
2. 设置URL为：`https://your-domain.com/api/convert-url`
3. 设置请求体为：
   ```json
   {
     "image_url": "https://example.com/your-image.jpg",
     "return_type": "url"
   }
   ```
4. 运行工作流，获取圆形图片URL

---

**恭喜！** 现在您可以在扣子工作流中实现一键圆形图片转换功能了！🎉

**新功能亮点：**
- 🚀 **URL输入**：直接使用图片链接，无需上传
- 🔗 **URL输出**：获取处理后的图片链接，方便分享
- ⚡ **更快速**：减少数据传输，提高处理效率
