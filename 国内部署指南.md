# 🚀 国内API部署指南

## 📋 部署概述

本指南将帮助您将支持URL输入输出的圆形图片转换服务部署到国内服务器。

## 🔧 部署文件说明

### 核心文件
- `app_domestic.py` - 国内部署版本的主应用文件
- `requirements_domestic.txt` - 国内部署的依赖包
- `vercel_domestic.json` - Vercel部署配置（如果使用Vercel）

### 新增功能
- ✅ 支持图片URL输入
- ✅ 支持返回处理后的图片URL
- ✅ 支持文件下载功能
- ✅ 增强的错误处理
- ✅ 网络超时保护

## 🌐 部署方式

### 方式1：Vercel部署（推荐）

1. **准备文件**
   ```bash
   # 重命名文件
   mv app_domestic.py app.py
   mv requirements_domestic.txt requirements.txt
   mv vercel_domestic.json vercel.json
   ```

2. **推送到Git仓库**
   ```bash
   git add .
   git commit -m "feat: 添加国内部署版本，支持URL输入输出"
   git push origin main
   ```

3. **在Vercel中部署**
   - 连接到GitHub仓库
   - 自动部署完成

### 方式2：传统服务器部署

1. **上传文件到服务器**
   ```bash
   scp app_domestic.py user@your-server:/path/to/app/
   scp requirements_domestic.txt user@your-server:/path/to/app/requirements.txt
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements_domestic.txt
   ```

3. **运行应用**
   ```bash
   python app_domestic.py
   ```

4. **使用Gunicorn（生产环境）**
   ```bash
   gunicorn -w 4 -b 0.0.0.0:5000 app_domestic:app
   ```

## 🔗 API端点

### 1. 基础转换（base64输入）
```
POST /api/convert
```

**请求体：**
```json
{
  "image_base64": "data:image/png;base64,...",
  "size": 400
}
```

### 2. URL输入转换（新功能）
```
POST /api/convert-url
```

**请求体：**
```json
{
  "image_url": "https://example.com/image.jpg",
  "size": 400,
  "return_type": "url"
}
```

**响应：**
```json
{
  "success": true,
  "image_url": "https://api.songgeixiaopengyoudeliwu.icu/download/circular_abc123.png",
  "filename": "circular_abc123.png",
  "message": "图片已成功转换为圆形轮廓",
  "timestamp": "2024-01-01T12:00:00"
}
```

### 3. 文件下载
```
GET /download/{filename}
```

### 4. 健康检查
```
GET /api/health
```

## 🧪 测试部署

### 测试URL输入功能
```bash
curl -X POST https://api.songgeixiaopengyoudeliwu.icu/api/convert-url \
  -H "Content-Type: application/json" \
  -d '{
    "image_url": "https://picsum.photos/400/400",
    "size": 300,
    "return_type": "url"
  }'
```

### 预期响应
```json
{
  "success": true,
  "image_url": "https://api.songgeixiaopengyoudeliwu.icu/download/circular_abc123.png",
  "filename": "circular_abc123.png",
  "message": "图片已成功转换为圆形轮廓",
  "timestamp": "2024-01-01T12:00:00"
}
```

## 🔧 环境变量配置

### 必需的环境变量
```bash
BASE_URL=https://api.songgeixiaopengyoudeliwu.icu
```

### 可选的环境变量
```bash
FLASK_ENV=production
PORT=5000
```

## 📁 目录结构

```
project/
├── app_domestic.py          # 主应用文件
├── requirements_domestic.txt # 依赖包
├── vercel_domestic.json     # Vercel配置
├── uploads/                 # 上传目录
├── outputs/                 # 输出目录
└── templates/               # 模板目录
    └── index.html
```

## 🚨 注意事项

1. **文件权限**：确保uploads和outputs目录有写权限
2. **网络访问**：确保服务器可以访问外部图片URL
3. **存储空间**：定期清理outputs目录中的旧文件
4. **安全设置**：在生产环境中配置适当的CORS和安全头

## 🔄 更新流程

1. 修改 `app_domestic.py`
2. 测试功能
3. 推送到Git仓库
4. 自动部署（如果使用Vercel）

## 📞 技术支持

如果部署过程中遇到问题：
1. 检查服务器日志
2. 验证依赖包安装
3. 测试网络连接
4. 查看错误信息

---

**部署完成后，您的国内API将支持完整的URL输入输出功能！** 🎉
